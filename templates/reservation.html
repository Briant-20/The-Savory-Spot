{% extends "base.html" %}
{% block content %}
{% if not user.is_authenticated %}
<H1>Please log in to book a reservation</H1>
{% endif %}
{% if user.is_authenticated %}
    <h2>Create New Reservation:</h2>
    {% if not user.is_authenticated %}
    <p>Please log in to book a reservation.</p>
    {% endif %}
    <script type="application/json" id="user-details">
        {
            "email": "{{ user.email }}",
            "username": "{{ user.username }}"
        }
    </script>
    <form method="post" action="{% url 'reservation' %}">
        {% csrf_token %}
        <label for="year">Year:</label>
        <select name="year" id="year" required>
            <option value="{{ current_year }}">{{ current_year }}</option>
            {% for i in "123" %}
                <option value="{{ current_year|add:forloop.counter }}">{{ current_year|add:forloop.counter }}</option>
            {% endfor %}
        </select><br>

        <label for="month">Month:</label>
        <select name="month" id="month" required>
            <option value="">Select month</option>
            {% for i in monthRange %}
                <option value="{{ forloop.counter }}">{{ forloop.counter }}</option>
            {% endfor %}
        </select><br>

        <label for="day">Date:</label>
        <select name="day" id="day" required>
            <option value="">Select day</option>
        </select><br>

        <label for="time">Time:</label>
        <select name="time" id="time" required>
            <option value="">Select a time</option>
            {% for hour in timeRange %}
                <option value="{{ hour }}:00">{{ hour }}:00</option>
                <option value="{{ hour }}:30">{{ hour }}:30</option>
            {% endfor %}
        </select><br>

        <button type="submit" name="submit_reservation">Create Reservation</button>
    </form>
{%if reserved%}
<div class="alert alert-success" role="alert">
    Your reservation has been booked
</div>
{%endif%}
{%if booked%}
<div class="alert alert-danger" role="alert">
    Sorry this time is fully booked out
</div>
{%endif%}
<h1>Your Reservations:</h1>
        <ul>
            {% for reservation in user_reservations %}
            <li>
                Date: {{ reservation.day }}/{{ reservation.month }}/{{ reservation.year }},
                Time: {{ reservation.time }},
                Table: {{ reservation.table }}
                <form method="post" action="{% url 'reservation' %}">
                    {% csrf_token %}
                    <input type="hidden" name="delete_reservation" value="{{ reservation.id }}">
                    <button type="submit">Delete</button>
                </form>
            </li>
        {% endfor %}
        </ul>
{% endif %}
{% endblock %}
